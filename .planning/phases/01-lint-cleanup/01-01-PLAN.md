---
phase: 01-lint-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - setup.yml
  - tools/*/install_*.yml
  - themes/*.yml
autonomous: true

must_haves:
  truths:
    - "All ansible.builtin modules use FQCN"
    - "All community.general modules use FQCN"
    - "All boolean values use true/false"
  artifacts:
    - path: "setup.yml"
      provides: "Main playbook with FQCN and truthy fixes"
    - path: "tools/*/install_*.yml"
      provides: "Tool playbooks with FQCN and truthy fixes"
  key_links:
    - from: "all .yml files"
      to: "ansible.builtin.*"
      via: "module name replacement"
      pattern: "ansible\\.builtin\\.(shell|command|apt|file|stat|copy|lineinfile|blockinfile|get_url|template|debug|user|systemd|git|unarchive|set_fact|service|raw|hostname|apt_repository)"
---

<objective>
Fix FQCN and truthy violations across all playbooks

Purpose: Address 677 violations (413 fqcn[action-core] + 264 yaml[truthy]) which are the bulk of lint errors. These are mechanical transformations.

Output: All playbooks use `ansible.builtin.*` for core modules, `community.general.*` for non-builtin modules, and `true`/`false` for booleans.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

Module mapping for FQCN:
- shell -> ansible.builtin.shell
- command -> ansible.builtin.command
- apt -> ansible.builtin.apt
- file -> ansible.builtin.file
- stat -> ansible.builtin.stat
- copy -> ansible.builtin.copy
- lineinfile -> ansible.builtin.lineinfile
- blockinfile -> ansible.builtin.blockinfile
- get_url -> ansible.builtin.get_url
- template -> ansible.builtin.template
- debug -> ansible.builtin.debug
- user -> ansible.builtin.user
- systemd -> ansible.builtin.systemd
- git -> ansible.builtin.git
- unarchive -> ansible.builtin.unarchive
- set_fact -> ansible.builtin.set_fact
- service -> ansible.builtin.service
- raw -> ansible.builtin.raw
- hostname -> ansible.builtin.hostname
- apt_repository -> ansible.builtin.apt_repository
- pacman -> community.general.pacman
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix FQCN violations for builtin modules</name>
  <files>setup.yml, tools/*/install_*.yml, themes/*.yml</files>
  <action>
For each playbook file, replace bare module names with their FQCN equivalents.

Target modules (all become ansible.builtin.*):
- shell, command, apt, file, stat, copy
- lineinfile, blockinfile, get_url, template
- debug, user, systemd, git, unarchive
- set_fact, service, raw, hostname, apt_repository

Also fix `pacman` -> `community.general.pacman`

The pattern is: lines that start with whitespace followed by the module name and colon.
Example: `      shell:` becomes `      ansible.builtin.shell:`

Use a script approach - iterate through all yml files and apply replacements.
Be careful to only replace module names at the start of YAML keys, not within strings.
  </action>
  <verify>
Run `ansible-lint setup.yml 2>&1 | grep -c 'fqcn\[action'` and verify count drops significantly from 477.
  </verify>
  <done>Zero fqcn[action-core] and fqcn[action] violations remain</done>
</task>

<task type="auto">
  <name>Task 2: Fix truthy violations (yes/no -> true/false)</name>
  <files>setup.yml, tools/*/install_*.yml, themes/*.yml</files>
  <action>
Replace YAML truthy values:
- `yes` -> `true` (when used as boolean value, not in strings)
- `no` -> `false` (when used as boolean value, not in strings)

Common patterns to fix:
- `become: yes` -> `become: true`
- `update_cache: yes` -> `update_cache: true`
- `create: yes` -> `create: true`
- `state: yes` -> `state: true`
- `changed_when: false` (already correct, leave alone)

Be careful with context:
- Do NOT change `yes` or `no` inside quoted strings
- Do NOT change `yes` or `no` in task names or comments
- Only change boolean values after colons in YAML
  </action>
  <verify>
Run `ansible-lint setup.yml 2>&1 | grep -c 'yaml\[truthy\]'` and verify count is 0.
  </verify>
  <done>Zero yaml[truthy] violations remain</done>
</task>

</tasks>

<verification>
After completing both tasks:
1. Run `ansible-lint setup.yml 2>&1 | grep -E 'fqcn|truthy' | wc -l` - should be 0 or near 0
2. Spot-check a few files to confirm changes look correct
3. Ensure playbooks are still valid YAML: `python -c "import yaml; yaml.safe_load(open('setup.yml'))"`
</verification>

<success_criteria>
- Zero fqcn[action-core] violations
- Zero fqcn[action] violations
- Zero yaml[truthy] violations
- All playbooks remain valid YAML
- No unintended changes to strings or comments
</success_criteria>

<output>
After completion, create `.planning/phases/01-lint-cleanup/01-01-SUMMARY.md`
</output>
