---
phase: 01-lint-cleanup
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - tools/1password/install_1password.yml
  - tools/1password_cli/install_1password_cli.yml
  - tools/brave/install_brave.yml
  - tools/edge/install_edge.yml
  - tools/gcloud/install_gcloud.yml
  - tools/gh/install_gh.yml
  - tools/lazygit/install_lazygit.yml
  - tools/nas/install_nas.yml
  - tools/neovim/install_neovim.yml
  - tools/opera/install_opera.yml
  - tools/vivaldi/install_vivaldi.yml
  - setup.yml
  - tools/yay/install_yay.yml
autonomous: true

must_haves:
  truths:
    - "No lines exceed 160 characters"
    - "Git modules specify version/refspec"
  artifacts:
    - path: "tools/*/install_*.yml"
      provides: "Playbooks with wrapped long lines and pinned git versions"
  key_links:
    - from: "git module calls"
      to: "version parameter"
      via: "explicit version or refspec"
      pattern: "ansible\\.builtin\\.git:.*version:"
---

<objective>
Fix remaining lint violations: line-length and latest[git]

Purpose: Address 12 yaml[line-length] and 3 latest[git] violations. These are the final violations after FQCN/truthy/names are fixed.

Output: All lines under 160 chars, all git module calls specify a version.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

Files with line-length violations (lines > 160 chars):
- tools/1password/install_1password.yml
- tools/1password_cli/install_1password_cli.yml
- tools/brave/install_brave.yml
- tools/edge/install_edge.yml
- tools/gcloud/install_gcloud.yml
- tools/gh/install_gh.yml
- tools/lazygit/install_lazygit.yml
- tools/nas/install_nas.yml (2 violations)
- tools/neovim/install_neovim.yml
- tools/opera/install_opera.yml
- tools/vivaldi/install_vivaldi.yml

Files with latest[git] violations (git module without version):
- setup.yml (dotfiles clone/update)
- tools/yay/install_yay.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wrap long lines in playbooks</name>
  <files>See files_modified list - 11 files with line-length issues</files>
  <action>
For each file with yaml[line-length] violations, wrap the long line using YAML multiline syntax.

Common patterns for long lines:
1. Long shell commands - use `|` for multiline:
   ```yaml
   ansible.builtin.shell: |
     curl -sS https://example.com/script.sh | bash
   ```

2. Long `creates:` or `args:` - put on separate line with proper indentation

3. Long URLs in comments or names - wrap naturally

Find violations: `ansible-lint setup.yml 2>&1 | grep 'line-length' -B2 | grep '.yml:'`

For each file, identify the specific long line and wrap it appropriately while maintaining valid YAML.
  </action>
  <verify>
Run `ansible-lint setup.yml 2>&1 | grep -c 'yaml\[line-length\]'` - should be 0.
  </verify>
  <done>Zero yaml[line-length] violations remain</done>
</task>

<task type="auto">
  <name>Task 2: Pin git versions to avoid latest[git] warnings</name>
  <files>setup.yml, tools/yay/install_yay.yml</files>
  <action>
For git module calls that clone repositories, add a `version:` parameter.

In setup.yml (dotfiles clone):
- The dotfiles repo should use `version: HEAD` or `version: master` to indicate tracking the default branch explicitly

In tools/yay/install_yay.yml:
- Yay clones from AUR, pin to a specific tag or use `version: master`

Pattern to change:
```yaml
ansible.builtin.git:
  repo: "{{ repo_url }}"
  dest: ~/path
```

Change to:
```yaml
ansible.builtin.git:
  repo: "{{ repo_url }}"
  dest: ~/path
  version: HEAD
```

Note: Using `version: HEAD` explicitly tells ansible-lint we acknowledge we want latest, while still being explicit about it.
  </action>
  <verify>
Run `ansible-lint setup.yml 2>&1 | grep -c 'latest\[git\]'` - should be 0.
  </verify>
  <done>Zero latest[git] violations remain</done>
</task>

</tasks>

<verification>
After completing both tasks:
1. Run full lint check: `ansible-lint setup.yml 2>&1 | tail -20`
2. Verify exit code: `ansible-lint setup.yml; echo "Exit code: $?"`
3. Exit code should be 0 (no violations)
</verification>

<success_criteria>
- Zero yaml[line-length] violations
- Zero latest[git] violations
- `ansible-lint setup.yml` returns exit code 0
- `ansible-lint tools/*/install_*.yml` returns exit code 0
</success_criteria>

<output>
After completion, create `.planning/phases/01-lint-cleanup/01-03-SUMMARY.md`
</output>
