---
phase: 09-script-security
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - tools/sops/install_sops.yml
  - tools/1password/install_1password.yml
  - tools/1password_cli/install_1password_cli.yml
  - tools/docker/install_docker.yml
  - tools/gh/install_gh.yml
  - tools/wezterm/install_wezterm.yml
  - tools/edge/install_edge.yml
  - tools/gcloud/install_gcloud.yml
  - tools/vivaldi/install_vivaldi.yml
  - tools/opera/install_opera.yml
autonomous: true

must_haves:
  truths:
    - "sops binary download verifies checksum before installation"
    - "All APT repository GPG key tasks have fingerprint comments"
    - "ansible-lint still passes after changes"
  artifacts:
    - path: "tools/sops/install_sops.yml"
      provides: "Checksum-verified sops download"
      contains: "sha256:"
    - path: "tools/docker/install_docker.yml"
      provides: "GPG fingerprint comment"
      contains: "9DC8 5822"
    - path: "tools/gh/install_gh.yml"
      provides: "GPG fingerprint comment"
      contains: "2C6106201985B60E6C7AC87323F3D4EA75716059"
    - path: "tools/1password/install_1password.yml"
      provides: "GPG fingerprint comment"
      contains: "3FEF9748469ADBE15DA7CA80AC2D62742012EA22"
  key_links:
    - from: "tools/sops/install_sops.yml"
      to: "GitHub releases"
      via: "ansible.builtin.get_url with checksum"
      pattern: "checksum.*sha256"
---

<objective>
Add checksum verification to sops binary download and document GPG key fingerprints for all APT repositories.

Purpose: Checksum verification prevents tampering of downloaded binaries. GPG fingerprint documentation enables verification of repository signing keys and helps detect key rotation/expiration issues.

Output: 10 updated playbooks - 1 with checksum verification, 9 with GPG fingerprint comments.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-script-security/09-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add checksum verification to sops download</name>
  <files>tools/sops/install_sops.yml</files>
  <action>
Read tools/sops/install_sops.yml first.

Replace the Debian curl download with ansible.builtin.get_url that verifies checksum.

Update the Debian section to:
```yaml
  vars:
    sops_version: "3.11.0"
    # Checksum from https://github.com/getsops/sops/releases/download/v3.11.0/sops-v3.11.0.checksums.txt
    sops_checksum: "sha256:775f1384d55decfad228e7196a3f683791914f92a473f78fc47700531c29dfef"

  tasks:
    - name: Install sops via Homebrew
      ansible.builtin.shell: /opt/homebrew/bin/brew install sops
      args:
        creates: /opt/homebrew/bin/sops
      when: ansible_facts['os_family'] == "Darwin"

    - name: Download sops with checksum verification (Debian)
      ansible.builtin.get_url:
        url: "https://github.com/getsops/sops/releases/download/v{{ sops_version }}/sops-v{{ sops_version }}.linux.amd64"
        dest: /usr/local/bin/sops
        mode: '0755'
        checksum: "{{ sops_checksum }}"
      become: true
      when: ansible_facts['os_family'] == "Debian"

    - name: Install sops via yay (Arch)
      ansible.builtin.shell: yay -S --noconfirm sops
      args:
        creates: /usr/bin/sops
      when: ansible_facts['os_family'] == "Archlinux"
```

This removes the stat check (get_url is already idempotent) and adds checksum verification.
  </action>
  <verify>grep -E "(checksum|sha256)" tools/sops/install_sops.yml</verify>
  <done>sops download uses ansible.builtin.get_url with SHA256 checksum verification</done>
</task>

<task type="auto">
  <name>Task 2: Add GPG fingerprint comments to APT repository tasks</name>
  <files>tools/1password/install_1password.yml, tools/1password_cli/install_1password_cli.yml, tools/docker/install_docker.yml, tools/gh/install_gh.yml, tools/wezterm/install_wezterm.yml</files>
  <action>
Read each file first, then add GPG fingerprint comments above the GPG key download/repository tasks.

**tools/1password/install_1password.yml:**
Add above "Add 1Password apt repository" task:
```yaml
    - name: Add 1Password apt repository (Debian)
      # GPG Key Fingerprint: 3FEF9748469ADBE15DA7CA80AC2D62742012EA22
      # Verify at: https://support.1password.com/install-linux/
      ansible.builtin.shell: |
```

**tools/1password_cli/install_1password_cli.yml:**
Read file first. Add similar GPG fingerprint comment to any GPG key task:
```yaml
      # GPG Key Fingerprint: 3FEF9748469ADBE15DA7CA80AC2D62742012EA22
      # Verify at: https://support.1password.com/install-linux/
```

**tools/docker/install_docker.yml:**
Add above "Add Docker GPG key" task:
```yaml
    - name: Add Docker GPG key (Debian)
      # GPG Key Fingerprint: 9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88
      # Verify at: https://docs.docker.com/engine/install/ubuntu/
      ansible.builtin.shell: curl -fsSL https://download.docker.com/linux/debian/gpg | gpg --dearmor -o /etc/apt/keyrings/docker.gpg
```

**tools/gh/install_gh.yml:**
Add above "Add GitHub CLI apt repository" task:
```yaml
    - name: Add GitHub CLI apt repository (Debian)
      # GPG Key Fingerprint: 2C6106201985B60E6C7AC87323F3D4EA75716059
      # Key expires: September 2026 (check https://github.blog for rotation announcements)
      # Verify at: https://github.com/cli/cli/blob/trunk/docs/install_linux.md
      ansible.builtin.shell: |
```

**tools/wezterm/install_wezterm.yml:**
Read file first. Add GPG fingerprint comment:
```yaml
      # GPG Key ID: D7BA31CF90C4B319
      # Hosted at: https://apt.fury.io/wez/
```
  </action>
  <verify>grep -l "GPG Key" tools/1password/install_1password.yml tools/docker/install_docker.yml tools/gh/install_gh.yml | wc -l</verify>
  <done>1password, docker, gh, wezterm have GPG fingerprint comments</done>
</task>

<task type="auto">
  <name>Task 3: Add GPG fingerprint comments to remaining APT tools</name>
  <files>tools/edge/install_edge.yml, tools/gcloud/install_gcloud.yml, tools/vivaldi/install_vivaldi.yml, tools/opera/install_opera.yml</files>
  <action>
Read each file first, then add GPG fingerprint comments to the GPG key tasks.

**tools/edge/install_edge.yml:**
```yaml
      # GPG Key Fingerprint: BC52 8686 B50D 79E3 39D3 721C EB3E 94AD BE12 29CF
      # Verify at: https://www.microsoft.com/en-us/edge/download
```

**tools/gcloud/install_gcloud.yml:**
```yaml
      # GPG Key ID: 3746 C208 A731 7B0F
      # Verify at: https://cloud.google.com/sdk/docs/install
```

**tools/vivaldi/install_vivaldi.yml:**
```yaml
      # GPG Key Fingerprint: CB63 144F 1BA3 1BC3 9E27 79A8 FEB6 023D C27A A466
      # Verify at: https://vivaldi.com/download/
```

**tools/opera/install_opera.yml:**
```yaml
      # GPG Key Fingerprint: 6C86BE214648376680CA957B11EE8C00B693A745
      # Verify at: https://www.opera.com/download
```

Find the GPG key download task in each file and add the comment directly above it.
  </action>
  <verify>grep -l "GPG Key" tools/edge/install_edge.yml tools/gcloud/install_gcloud.yml tools/vivaldi/install_vivaldi.yml tools/opera/install_opera.yml | wc -l</verify>
  <done>edge, gcloud, vivaldi, opera have GPG fingerprint comments</done>
</task>

</tasks>

<verification>
```bash
# sops has checksum
grep "checksum" tools/sops/install_sops.yml

# All APT tools have GPG fingerprint comments (9 files)
for f in 1password 1password_cli docker gh wezterm edge gcloud vivaldi opera; do
  grep -q "GPG Key" tools/$f/install_*.yml && echo "$f: OK" || echo "$f: MISSING"
done

# Lint passes
ansible-lint tools/sops/install_sops.yml tools/1password/install_1password.yml tools/docker/install_docker.yml tools/gh/install_gh.yml
```
</verification>

<success_criteria>
- sops uses ansible.builtin.get_url with SHA256 checksum verification
- All 9 APT repository tools have GPG fingerprint comments with verify URLs
- ansible-lint passes on all modified files
</success_criteria>

<output>
After completion, create `.planning/phases/09-script-security/09-02-SUMMARY.md`
</output>
