---
phase: 10-documentation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - README.md
  - CLAUDE.md
autonomous: true

must_haves:
  truths:
    - "nvm curl-to-shell risk is documented with mitigation options"
    - "Rollback/recovery procedures exist for common failure scenarios"
    - "Theme system testing guidance is present in CLAUDE.md"
    - "Documentation is findable in expected locations (README, CLAUDE.md)"
  artifacts:
    - path: "README.md"
      provides: "Security Considerations section documenting curl-to-shell risks"
      contains: "## Security Considerations"
    - path: "README.md"
      provides: "Troubleshooting section with rollback/recovery procedures"
      contains: "## Troubleshooting"
    - path: "CLAUDE.md"
      provides: "Theme testing guidance in Nerd Font section"
      contains: "### Testing Theme Changes"
  key_links:
    - from: "README.md"
      to: "tools/node/install_node.yml"
      via: "documents nvm pinning"
      pattern: "nvm.*pinned"
    - from: "README.md"
      to: "themes/apply_defaults.yml"
      via: "references default restore command"
      pattern: "themes/apply_defaults"
    - from: "CLAUDE.md"
      to: "themes/_color.yml"
      via: "documents testing procedure"
      pattern: "themes/_color.yml"
---

<objective>
Document operational risks and recovery procedures for the _dotfiles repository, completing the v0.3 Security & Documentation milestone.

Purpose: Capture maintainer knowledge about security risks (curl-to-shell patterns) and operational procedures (rollback/recovery, theme testing) so future maintainers (human or AI) can understand and safely modify the codebase.

Output:
- README.md with new "Security Considerations" and "Troubleshooting" sections
- CLAUDE.md with extended "Nerd Font / Powerline Characters" section including theme testing guidance
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/10-documentation/10-RESEARCH.md
@README.md
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Security Considerations section to README.md</name>
  <files>README.md</files>
  <action>
Add a new "## Security Considerations" section to README.md, placed after the "Nerd Font / Powerline Characters" section and before "## Project Structure".

Content should include:
1. **Curl-to-Shell Installation Patterns** subsection explaining the risk
2. Table of affected tools with their mitigation status:
   - nvm: Pinned to v0.40.1
   - Homebrew: Pinned to commit SHA
   - Pulumi: Pinned to v3.216.0
   - uv: Pinned to v0.9.26
   - rustup: Cannot pin (documented)
   - starship: Cannot pin (documented)
3. **How to update pinned versions** subsection with steps:
   - Check for latest release via GitHub API
   - Review changelog
   - Update version in playbook
   - Test with --check mode
4. **Unpinnable tools** note explaining alternatives (rustup GPG installer, starship binary download)

Use the example content from 10-RESEARCH.md as a guide but adapt to actual current state in codebase. Verify pinned versions by checking actual playbook files if needed.
  </action>
  <verify>
- `grep -c "## Security Considerations" README.md` returns 1
- `grep "nvm.*pinned\|nvm.*v0.40" README.md` finds nvm documentation
- `grep "Curl-to-Shell" README.md` finds the risk explanation
- Section appears after "Nerd Font" section: `grep -n "## Security\|## Project Structure\|## Nerd Font" README.md` shows correct ordering
  </verify>
  <done>README.md contains a "Security Considerations" section documenting curl-to-shell risks, listing all affected tools with their mitigation status, and explaining how to update pinned versions.</done>
</task>

<task type="auto">
  <name>Task 2: Add Troubleshooting section to README.md</name>
  <files>README.md</files>
  <action>
Add a new "## Troubleshooting" section to README.md, placed after the new "Security Considerations" section and before "## Project Structure".

Content should include scenario-based recovery procedures:

1. **Theme Changes** subsection:
   - "Powerline Separators Show as Boxes" - cause and fix (install Nerd Font)
   - "Colors Unreadable After Theme Change" - restore defaults command
   - "Theme Playbook Corrupted Special Characters" - git checkout restore

2. **Playbook Failures** subsection:
   - "Playbook Stopped with Error" - rerun is safe (idempotent), common causes
   - "GPG Key Expired (APT Update Fails)" - re-download key procedure, note GitHub CLI expires Sep 2026
   - "SOPS Decryption Failed" - check Age key exists, restore from 1Password

3. **Starting Over** subsection:
   - Backup customizations
   - Remove and re-bootstrap
   - Note that Ansible is idempotent so most failures recoverable by rerun

Use the example content from 10-RESEARCH.md as a guide.
  </action>
  <verify>
- `grep -c "## Troubleshooting" README.md` returns 1
- `grep "Starting Over" README.md` finds nuclear option section
- `grep "idempotent" README.md` mentions rerun safety
- `grep "GPG Key Expired" README.md` finds key expiration scenario
- Section appears before "Project Structure": `grep -n "## Troubleshooting\|## Project Structure" README.md` shows correct ordering
  </verify>
  <done>README.md contains a "Troubleshooting" section with scenario-based recovery procedures for theme changes, playbook failures, GPG key expiration, SOPS decryption issues, and nuclear "starting over" option.</done>
</task>

<task type="auto">
  <name>Task 3: Add theme testing guidance to CLAUDE.md</name>
  <files>CLAUDE.md</files>
  <action>
Extend the existing "## Nerd Font / Powerline Characters" section in CLAUDE.md by adding a new "### Testing Theme Changes" subsection at the end of that section (after "### Reference Examples").

Content should include:

1. **Introduction** - Theme playbooks modify 9 config files, testing required

2. **Before committing theme changes** checklist:
   - Run in --check mode first with example command
   - Verify special characters not corrupted (grep for escape sequences)
   - Visual validation checklist (tmux, starship, neovim, fzf, lazygit)
   - Common mistakes checklist

3. **If theme breaks** recovery steps:
   - Restore defaults command
   - Check git diff
   - Restore corrupted files

4. **Testing new theme definitions** procedure for adding new color schemes

5. **Why this matters** explanation of fragility

Use the example content from 10-RESEARCH.md as a guide.
  </action>
  <verify>
- `grep -c "### Testing Theme Changes" CLAUDE.md` returns 1
- `grep "themes/_color.yml" CLAUDE.md` finds theme testing example
- `grep "\-\-check" CLAUDE.md` finds check mode guidance
- `grep "Visual validation" CLAUDE.md` OR `grep "visual validation" CLAUDE.md` finds validation checklist
- Subsection appears within Nerd Font section: `grep -B5 "Testing Theme Changes" CLAUDE.md | grep -c "Nerd Font\|Powerline"` returns at least 1
  </verify>
  <done>CLAUDE.md contains a "Testing Theme Changes" subsection within the Nerd Font section, providing pre-commit checks, visual validation checklist, recovery procedures, and guidance for adding new themes.</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Documentation findability:**
   - Security info in README.md (expected location)
   - Troubleshooting in README.md (expected location)
   - Theme testing in CLAUDE.md (maintainer instructions)

2. **Requirement coverage:**
   - DOC-01: `grep "nvm" README.md | grep -i "risk\|curl\|pinned"` confirms nvm risk documented
   - DOC-02: `grep "## Troubleshooting" README.md` confirms rollback section exists
   - DOC-03: `grep "Testing Theme Changes" CLAUDE.md` confirms theme guidance exists

3. **Content quality:**
   - Sections have actionable procedures (commands to run)
   - Tables present where appropriate
   - Links to relevant files/playbooks where referenced
</verification>

<success_criteria>
1. README.md contains "## Security Considerations" section with curl-to-shell risk documentation
2. README.md contains "## Troubleshooting" section with scenario-based recovery procedures
3. CLAUDE.md contains "### Testing Theme Changes" subsection with pre-commit and visual validation guidance
4. All three requirements (DOC-01, DOC-02, DOC-03) are addressed with findable documentation
5. Documentation follows existing markdown patterns in the codebase
</success_criteria>

<output>
After completion, create `.planning/phases/10-documentation/10-01-SUMMARY.md`
</output>
