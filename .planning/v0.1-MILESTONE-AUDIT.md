---
milestone: v0.1
audited: 2026-01-21
status: gaps_found
scores:
  requirements: 8/10
  phases: 3/3
  integration: 1/2
  flows: 1/2
gaps:
  requirements:
    - "TOOL-01: Hook exists but not registered in settings.json"
    - "TOOL-02: Hook never triggers, cannot report errors"
  integration:
    - "ansible-lint.sh deployed but not wired to PostToolUse"
  flows:
    - "E2E: Edit YAML -> Hook triggers -> Errors shown (BROKEN at step 2)"
tech_debt:
  - phase: 01-lint-cleanup
    items:
      - "267 non-targeted violations remain (command-instead-of-shell, risky-file-permissions, etc.)"
---

# Milestone v0.1: Lint & Tooling — Audit Report

**Audited:** 2026-01-21 (Re-audited with integration check)
**Status:** gaps_found
**Overall Score:** 8/10 requirements satisfied

## Executive Summary

Milestone v0.1 achieved 8 of 10 requirements. All lint cleanup (LINT-01 through LINT-06) and validation (VALID-01, VALID-02) requirements are complete. However, **the tooling requirements (TOOL-01, TOOL-02) have a critical integration gap**: the ansible-lint hook file exists and is deployed, but it is NOT registered in Claude Code's settings.json, so it never executes.

## Requirements Coverage

| Requirement | Description | Phase | Status | Evidence |
|-------------|-------------|-------|--------|----------|
| LINT-01 | Fix fqcn[action-core] violations (413) | 1 | ✓ Complete | 0 violations |
| LINT-02 | Fix yaml[truthy] violations (264) | 1 | ✓ Complete | 0 violations |
| LINT-03 | Fix name[play] violations (100) | 1 | ✓ Complete | 0 violations |
| LINT-04 | Fix fqcn[action] violations (64) | 1 | ✓ Complete | 0 violations |
| LINT-05 | Fix yaml[line-length] violations (12) | 1 | ✓ Complete | 0 violations |
| LINT-06 | Fix latest[git] violations (3) | 1 | ✓ Complete | 0 violations |
| VALID-01 | Syntax-check passes | 2 | ✓ Complete | All playbooks valid |
| VALID-02 | setup-all.sh succeeds | 2 | ✓ Complete | desktop + macmini OK |
| TOOL-01 | Post-write hook runs ansible-lint | 3 | ✗ **Incomplete** | Hook not registered |
| TOOL-02 | Hook reports errors clearly | 3 | ✗ **Incomplete** | Hook never triggers |

**Score:** 8/10 requirements satisfied

## Phase Status

### Phase 1: Lint Cleanup ✓

**Status:** Complete (verified 2026-01-20)
**Score:** 5/5 success criteria met

All targeted violations eliminated:
- fqcn[action-core]: 413 → 0
- fqcn[action]: 64 → 0
- yaml[truthy]: 264 → 0 (including wakeonlan daemon_reload fix)
- name[play]: ~100 → 0
- yaml[line-length]: 12 → 0
- latest[git]: 3 → 0

### Phase 2: Validation ✓

**Status:** Complete (validated 2026-01-21)
**Score:** 2/2 success criteria met

Ran `./setup-all.sh` on all hosts:
- **desktop (local):** 323 tasks OK, 0 failures
- **macmini (remote):** 318 tasks OK, 0 failures
- macbookair/miniserver: unreachable (machines offline)

### Phase 3: Tooling ✗ INCOMPLETE

**Status:** Incomplete — hook not wired
**Score:** 0/3 success criteria met

**The Problem:**

The ansible-lint hook was created and deployed, but **never registered**:

| Step | Status | Details |
|------|--------|---------|
| 1. Hook script created | ✓ | `tools/claude-code/hooks/ansible-lint.sh` exists |
| 2. Hook deployed via Ansible | ✓ | Copies to `~/.claude/hooks/ansible-lint.sh` |
| 3. Hook registered in settings.json | ✗ | **NOT FOUND** |

**Evidence:**

Current `~/.claude/settings.json` PostToolUse section:
```json
{
  "hooks": {
    "PostToolUse": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "node \"$HOME/.claude/hooks/gsd-intel-index.js\""
          }
        ]
      }
    ]
  }
}
```

No ansible-lint hook entry exists. The hook file at `~/.claude/hooks/ansible-lint.sh` is present and executable, but Claude Code never calls it.

**E2E Flow Analysis:**

| Step | Expected | Actual |
|------|----------|--------|
| 1. User edits .yml | Works | Works |
| 2. PostToolUse fires | Triggers ansible-lint.sh | **Does nothing** |
| 3. ansible-lint runs | Checks file | Never called |
| 4. Errors displayed | Shows violations | Never happens |

**Break point:** Step 2 — The hook is not registered.

## Required Fix

Add hook registration. Either:

**Option A: Manual (quick fix)**

Add to `~/.claude/settings.json`:
```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Edit|Write",
        "hooks": [
          {
            "type": "command",
            "command": "bash \"$HOME/.claude/hooks/ansible-lint.sh\""
          }
        ]
      }
    ]
  }
}
```

**Option B: Ansible task (proper solution)**

Add task to `install_claude-code.yml` to merge hook configuration into settings.json.

## Tech Debt

### Non-targeted Lint Violations (267 remaining)

These were explicitly out of scope for v0.1:

| Violation Type | Count |
|----------------|-------|
| command-instead-of-shell | 107 |
| risky-file-permissions | 72 |
| no-changed-when | 36 |
| command-instead-of-module | 29 |
| risky-shell-pipe | 19 |
| deprecated-local-action | 1 |
| Other | 3 |

**Recommendation:** Track in v0.2+ backlog

## Recommendation

**Do not complete milestone** until TOOL-01 and TOOL-02 are satisfied.

Run `/gsd:plan-milestone-gaps` to create a plan for closing the hook registration gap.

---

*Original audit: 2026-01-21 (incorrectly claimed passed)*
*Re-audited: 2026-01-21 with integration check*
*Status: gaps_found — hook registration required*
