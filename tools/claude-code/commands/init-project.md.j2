---
description: Initialize Claude Code config for a project
argument-hint: [project type - optional, will auto-detect]
---

Set up Claude Code configuration for this project using templates and project analysis.

## Step 1: Copy Templates (EXACT - do not modify structure)

Copy these files from `{{ ansible_env.HOME }}/_dotfiles/tools/claude-code/templates/` to the project:

| Template             | Destination                  | Action                                 |
| -------------------- | ---------------------------- | -------------------------------------- |
| `mcp.json`           | `.mcp.json`                  | Copy exactly                           |
| `settings.json`      | `.claude/settings.json`      | Copy, then customize hooks             |
| `agents/reviewer.md` | `.claude/agents/reviewer.md` | Copy, then add project-specific checks |
| `rules/tests.md`     | `.claude/rules/tests.md`     | Copy exactly                           |
| `CLAUDE.md`          | `CLAUDE.md`                  | Copy skeleton, then fill in            |
| `gitignore`          | Append to `.gitignore`       | Append if entries missing              |

Create directories first: `.claude/agents/`, `.claude/rules/`

## Step 2: Detect Project Type

Look for these indicators (or use hint: $ARGUMENTS):

- **Node.js**: package.json
- **Python**: pyproject.toml, setup.py, requirements.txt
- **Go**: go.mod
- **Rust**: Cargo.toml
- **Lua**: \*.lua files, .luacheckrc
- **Ansible**: playbook.yml, ansible.cfg, roles/
- **Terraform**: \*.tf files
- **Kubernetes**: kustomization.yaml, Chart.yaml, \*.yaml with `apiVersion:`/`kind:`

## Step 3: Customize Templates (AI-generated parts)

### CLAUDE.md

Fill in the skeleton with:

- Project name and description (from README or manifest)
- Actual tech stack and dependencies
- Real directory structure
- Working commands from package.json/Makefile/etc.
- Code style from existing linter configs

### .claude/settings.json

Add PostToolUse hooks based on detected tools (only if installed):

- **Formatters**: prettier, black, gofmt, rustfmt, stylua, yamlfmt
- **Linters**: eslint, ruff, golangci-lint, clippy, luacheck, ansible-lint, kubeval, helm lint
- **Tests**: npm test, pytest, go test, cargo test, busted
- **Kubernetes**: kubectl --dry-run=client, kubeconform, kustomize build

### .claude/agents/reviewer.md

Add project-specific checklist items:

- Ansible: YAML syntax, idempotency, vault usage, OS detection
- Lua: nil checks, global variables, stylua conventions
- Node: async/await, error handling, TypeScript types
- Python: type hints, docstrings, import organization
- Go: error handling, goroutine safety
- Kubernetes: resource limits, security contexts, liveness/readiness probes, image tags (no :latest), namespace specification, RBAC least privilege

## Step 4: Verify

After creating files, verify:

1. `.mcp.json` is valid JSON
2. Agent frontmatter has: name, description, tools, model
3. Rules frontmatter has: globs array
4. No template placeholders left (like `<!-- ... -->`)
