- name: Install k9s
  hosts: all
  gather_facts: true
  tasks:
    - name: Install k9s via Homebrew
      ansible.builtin.shell: /opt/homebrew/bin/brew install k9s
      args:
        creates: /opt/homebrew/bin/k9s
      when: ansible_facts['os_family'] == "Darwin"
    - name: Check if k9s is installed (Debian)
      ansible.builtin.stat:
        path: /usr/local/bin/k9s
      register: k9s_check
      when: ansible_facts['os_family'] == "Debian"
    - name: Download and install k9s (Debian)
      ansible.builtin.shell: |
        curl -Lo /tmp/k9s.tar.gz "https://github.com/derailed/k9s/releases/latest/download/k9s_Linux_amd64.tar.gz"
        tar xf /tmp/k9s.tar.gz -C /tmp k9s
        install /tmp/k9s /usr/local/bin
        rm -f /tmp/k9s /tmp/k9s.tar.gz
      become: true
      when: ansible_facts['os_family'] == "Debian" and not k9s_check.stat.exists
    - name: Install k9s via yay (Arch)
      ansible.builtin.shell: yay -S --noconfirm k9s
      args:
        creates: /usr/bin/k9s
      when: ansible_facts['os_family'] == "Archlinux"
    # macOS uses ~/Library/Application Support/k9s/
    - name: Create k9s skins directory (macOS)
      ansible.builtin.file:
        path: ~/Library/Application Support/k9s/skins
        state: directory
      when: ansible_facts['os_family'] == "Darwin"

    - name: Install k9s skin (macOS)
      ansible.builtin.copy:
        src: skin.yml
        dest: ~/Library/Application Support/k9s/skins/tokyonight.yml
      when: ansible_facts['os_family'] == "Darwin"

    - name: Create k9s config (macOS)
      ansible.builtin.copy:
        dest: ~/Library/Application Support/k9s/config.yaml
        content: |
          k9s:
            ui:
              skin: tokyonight
      when: ansible_facts['os_family'] == "Darwin"

    # Linux uses ~/.config/k9s/
    - name: Create k9s skins directory (Linux)
      ansible.builtin.file:
        path: ~/.config/k9s/skins
        state: directory
      when: ansible_facts['os_family'] != "Darwin"

    - name: Install k9s skin (Linux)
      ansible.builtin.copy:
        src: skin.yml
        dest: ~/.config/k9s/skins/tokyonight.yml
      when: ansible_facts['os_family'] != "Darwin"

    - name: Create k9s config (Linux)
      ansible.builtin.copy:
        dest: ~/.config/k9s/config.yml
        content: |
          k9s:
            ui:
              skin: tokyonight
      when: ansible_facts['os_family'] != "Darwin"
