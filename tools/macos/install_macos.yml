---
- name: Configure macOS system preferences
  hosts: macs
  gather_facts: false

  tasks:
    - name: Set HostName
      command: scutil --set HostName {{ ansible_host }}
      become: yes
      changed_when: false

    - name: Set LocalHostName
      command: scutil --set LocalHostName {{ inventory_hostname_short }}
      become: yes
      changed_when: false

    - name: Set ComputerName
      command: scutil --set ComputerName {{ inventory_hostname }}
      become: yes
      changed_when: false

    - name: Install Rosetta 2 for Intel app compatibility
      command: softwareupdate --install-rosetta --agree-to-license
      args:
        creates: /Library/Apple/usr/share/rosetta/rosetta
      become: yes

    - name: Auto-hide Dock
      command: defaults write com.apple.dock autohide -bool true
      changed_when: false

    - name: Show hidden files in Finder
      command: defaults write com.apple.finder AppleShowAllFiles -bool true
      changed_when: false

    - name: Restart Dock to apply changes
      command: killall Dock
      changed_when: false

    - name: Restart Finder to apply changes
      command: killall Finder
      changed_when: false
