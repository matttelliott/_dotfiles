---
- name: Install yay AUR helper
  hosts: arch
  gather_facts: true

  tasks:
    - name: Install base-devel and git
      community.general.pacman:
        name:
          - base-devel
          - git
        state: present
      become: true
      when: ansible_facts['os_family'] == "Archlinux"

    - name: Check if yay is installed
      ansible.builtin.stat:
        path: /usr/bin/yay
      register: yay_check
      when: ansible_facts['os_family'] == "Archlinux"

    - name: Clone yay repository
      ansible.builtin.git:
        repo: https://aur.archlinux.org/yay.git
        dest: /tmp/yay
        version: HEAD
      when: ansible_facts['os_family'] == "Archlinux" and not yay_check.stat.exists

    - name: Build and install yay
      ansible.builtin.shell: cd /tmp/yay && makepkg -si --noconfirm
      when: ansible_facts['os_family'] == "Archlinux" and not yay_check.stat.exists

    - name: Clean up yay build directory
      ansible.builtin.file:
        path: /tmp/yay
        state: absent
      when: ansible_facts['os_family'] == "Archlinux"
